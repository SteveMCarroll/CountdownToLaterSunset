var Dt=Object.defineProperty;var wt=(t,e,n)=>e in t?Dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var E=(t,e,n)=>wt(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const R=class R{constructor(){E(this,"currentLocation",null);E(this,"watchId",null)}static getInstance(){return R.instance||(R.instance=new R),R.instance}async getCurrentLocation(){if(this.currentLocation&&this.currentLocation.source==="geolocation")return{location:this.currentLocation};const e=await this.detectLocation();if(e.location)return this.currentLocation=e.location,this.saveLocationToStorage(e.location),e;const n=this.getStoredLocation();return n?(this.currentLocation=n,{location:n}):{location:null,error:e.error||{code:0,message:"No location available",fallbackRequired:!0}}}async detectLocation(){return navigator.geolocation?new Promise(e=>{const n={enableHighAccuracy:!1,timeout:3e3,maximumAge:3e5};navigator.geolocation.getCurrentPosition(o=>{const i={latitude:o.coords.latitude,longitude:o.coords.longitude,source:"geolocation",name:"Current Location"};e({location:i})},o=>{const i={code:o.code,message:this.getGeolocationErrorMessage(o.code),fallbackRequired:!0};e({location:null,error:i})},n)}):{location:null,error:{code:0,message:"Geolocation is not supported by this browser",fallbackRequired:!0}}}setManualLocation(e,n,o){const i={latitude:e,longitude:n,name:o||`${e.toFixed(4)}, ${n.toFixed(4)}`,source:"manual"};return this.currentLocation=i,this.saveLocationToStorage(i),i}async searchLocation(e){const n=[{name:"Seattle, WA",lat:47.6062,lng:-122.3321,aliases:["seattle","sea"]},{name:"New York, NY",lat:40.7128,lng:-74.006,aliases:["nyc","new york","manhattan"]},{name:"Los Angeles, CA",lat:34.0522,lng:-118.2437,aliases:["la","los angeles"]},{name:"Chicago, IL",lat:41.8781,lng:-87.6298,aliases:["chicago","chi"]},{name:"London, UK",lat:51.5074,lng:-.1278,aliases:["london"]},{name:"Paris, France",lat:48.8566,lng:2.3522,aliases:["paris"]},{name:"Tokyo, Japan",lat:35.6762,lng:139.6503,aliases:["tokyo"]},{name:"Sydney, Australia",lat:-33.8688,lng:151.2093,aliases:["sydney"]},{name:"Sammamish, WA",lat:47.6163,lng:-122.0356,aliases:["sammamish"]},{name:"Bellevue, WA",lat:47.6101,lng:-122.2015,aliases:["bellevue"]}],o=e.toLowerCase().trim();return n.filter(r=>r.name.toLowerCase().includes(o)||r.aliases.some(s=>s.includes(o))).map(r=>({latitude:r.lat,longitude:r.lng,name:r.name,source:"search"}))}getRecentLocations(){try{const e=localStorage.getItem("recentLocations");if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load recent locations:",e)}return[]}addToRecentLocations(e){try{const o=this.getRecentLocations().filter(r=>!(Math.abs(r.latitude-e.latitude)<.001&&Math.abs(r.longitude-e.longitude)<.001));o.unshift(e);const i=o.slice(0,5);localStorage.setItem("recentLocations",JSON.stringify(i))}catch(n){console.warn("Failed to save recent location:",n)}}saveLocationToStorage(e){try{localStorage.setItem("currentLocation",JSON.stringify(e)),this.addToRecentLocations(e)}catch(n){console.warn("Failed to save location to storage:",n)}}getStoredLocation(){try{const e=localStorage.getItem("currentLocation");if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load stored location:",e)}return null}startWatchingLocation(e){if(!navigator.geolocation||this.watchId!==null)return;const n={enableHighAccuracy:!1,timeout:15e3,maximumAge:6e5};this.watchId=navigator.geolocation.watchPosition(o=>{const i={latitude:o.coords.latitude,longitude:o.coords.longitude,source:"geolocation",name:"Current Location"};this.currentLocation=i,this.saveLocationToStorage(i),e(i)},o=>{const i={code:o.code,message:this.getGeolocationErrorMessage(o.code),fallbackRequired:!0};e(null,i)},n)}stopWatchingLocation(){this.watchId!==null&&navigator.geolocation&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}clearLocationData(){try{localStorage.removeItem("currentLocation"),localStorage.removeItem("recentLocations"),this.currentLocation=null}catch(e){console.warn("Failed to clear location data:",e)}}getGeolocationErrorMessage(e){switch(e){case 1:return"Location access denied by user";case 2:return"Location information is unavailable";case 3:return"Location request timed out";default:return"An unknown error occurred while retrieving location"}}async checkLocationPermission(){if(!navigator.permissions)return"unsupported";try{return(await navigator.permissions.query({name:"geolocation"})).state}catch{return"unsupported"}}getDefaultLocation(){return{latitude:47.6062,longitude:-122.3321,name:"Seattle, WA (Default)",source:"manual"}}isValidLocation(e,n){return e>=-90&&e<=90&&n>=-180&&n<=180}calculateDistance(e,n){const i=(n.latitude-e.latitude)*Math.PI/180,r=(n.longitude-e.longitude)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e.latitude*Math.PI/180)*Math.cos(n.latitude*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}};E(R,"instance");let b=R;const Z=Math.PI,J=.26667,q=.5667,B=6,z=2,H=5,Ct=63,Nt=[64,34,20,7,3,1],vt=[5,2],bt=[40,10,6,2,1],xt=0,pt=1,Ot=2,Bt=5,zt=0,Ht=1,kt=2,jt=3,L=-99999,Ft=[[[175347046,0,0],[3341656,4.6692568,6283.07585],[34894,4.6261,12566.1517],[3497,2.7441,5753.3849],[3418,2.8289,3.5231],[3136,3.6277,77713.7715],[2676,4.4181,7860.4194],[2343,6.1352,3930.2097],[1324,.7425,11506.7698],[1273,2.0371,529.691],[1199,1.1096,1577.3435],[990,5.233,5884.927],[902,2.045,26.298],[857,3.508,398.149],[780,1.179,5223.694],[753,2.533,5507.553],[505,4.583,18849.228],[492,4.205,775.523],[357,2.92,.067],[317,5.849,11790.629],[284,1.899,796.298],[271,.315,10977.079],[243,.345,5486.778],[206,4.806,2544.314],[205,1.869,5573.143],[202,2.458,6069.777],[156,.833,213.299],[132,3.411,2942.463],[126,1.083,20.775],[115,.645,.98],[103,.636,4694.003],[102,.976,15720.839],[102,4.267,7.114],[99,6.21,2146.17],[98,.68,155.42],[86,5.98,161000.69],[85,1.3,6275.96],[85,3.67,71430.7],[80,1.81,17260.15],[79,3.04,12036.46],[75,1.76,5088.63],[74,3.5,3154.69],[74,4.68,801.82],[70,.83,9437.76],[62,3.98,8827.39],[61,1.82,7084.9],[57,2.78,6286.6],[56,4.39,14143.5],[56,3.47,6279.55],[52,.19,12139.55],[52,1.33,1748.02],[51,.28,5856.48],[49,.49,1194.45],[41,5.37,8429.24],[41,2.4,19651.05],[39,6.17,10447.39],[37,6.04,10213.29],[37,2.57,1059.38],[36,1.71,2352.87],[36,1.78,6812.77],[33,.59,17789.85],[30,.44,83996.85],[30,2.74,1349.87],[25,3.16,4690.48]],[[628331966747,0,0],[206059,2.678235,6283.07585],[4303,2.6351,12566.1517],[425,1.59,3.523],[119,5.796,26.298],[109,2.966,1577.344],[93,2.59,18849.23],[72,1.14,529.69],[68,1.87,398.15],[67,4.41,5507.55],[59,2.89,5223.69],[56,2.17,155.42],[45,.4,796.3],[36,.47,775.52],[29,2.65,7.11],[21,5.34,.98],[19,1.85,5486.78],[19,4.97,213.3],[17,2.99,6275.96],[16,.03,2544.31],[16,1.43,2146.17],[15,1.21,10977.08],[12,2.83,1748.02],[12,3.26,5088.63],[12,5.27,1194.45],[12,2.08,4694],[11,.77,553.57],[10,1.3,6286.6],[10,4.24,1349.87],[9,2.7,242.73],[9,5.64,951.72],[8,5.3,2352.87],[6,2.65,9437.76],[6,4.67,4690.48]],[[52919,0,0],[8720,1.0721,6283.0758],[309,.867,12566.152],[27,.05,3.52],[16,5.19,26.3],[16,3.68,155.42],[10,.76,18849.23],[9,2.06,77713.77],[7,.83,775.52],[5,4.66,1577.34],[4,1.03,7.11],[4,3.44,5573.14],[3,5.14,796.3],[3,6.05,5507.55],[3,1.19,242.73],[3,6.12,529.69],[3,.31,398.15],[3,2.28,553.57],[2,4.38,5223.69],[2,3.75,.98]],[[289,5.844,6283.076],[35,0,0],[17,5.49,12566.15],[3,5.2,155.42],[1,4.72,3.52],[1,5.3,18849.23],[1,5.97,242.73]],[[114,3.142,0],[8,4.13,6283.08],[1,3.84,12566.15]],[[1,3.14,0]]],Zt=[[[280,3.199,84334.662],[102,5.422,5507.553],[80,3.88,5223.69],[44,3.7,2352.87],[32,4,1577.34]],[[9,3.9,5507.55],[6,1.73,5223.69]]],Jt=[[[100013989,0,0],[1670700,3.0984635,6283.07585],[13956,3.05525,12566.1517],[3084,5.1985,77713.7715],[1628,1.1739,5753.3849],[1576,2.8469,7860.4194],[925,5.453,11506.77],[542,4.564,3930.21],[472,3.661,5884.927],[346,.964,5507.553],[329,5.9,5223.694],[307,.299,5573.143],[243,4.273,11790.629],[212,5.847,1577.344],[186,5.022,10977.079],[175,3.012,18849.228],[110,5.055,5486.778],[98,.89,6069.78],[86,5.69,15720.84],[86,1.27,161000.69],[65,.27,17260.15],[63,.92,529.69],[57,2.01,83996.85],[56,5.24,71430.7],[49,3.25,2544.31],[47,2.58,775.52],[45,5.54,9437.76],[43,6.01,6275.96],[39,5.36,4694],[38,2.39,8827.39],[37,.83,19651.05],[37,4.9,12139.55],[36,1.67,12036.46],[35,1.84,2942.46],[33,.24,7084.9],[32,.18,5088.63],[32,1.78,398.15],[28,1.21,6286.6],[28,1.9,6279.55],[26,4.59,10447.39]],[[103019,1.10749,6283.07585],[1721,1.0644,12566.1517],[702,3.142,0],[32,1.02,18849.23],[31,2.84,5507.55],[25,1.32,5223.69],[18,1.42,1577.34],[10,5.91,10977.08],[9,1.42,6275.96],[9,.27,5486.78]],[[4359,5.7846,6283.0758],[124,5.579,12566.152],[12,3.14,0],[9,3.63,77713.77],[6,1.87,5573.14],[3,5.47,18849.23]],[[145,4.273,6283.076],[7,3.92,12566.15]],[[4,2.56,6283.08]]],qt=[[0,0,0,0,1],[-2,0,0,2,2],[0,0,0,2,2],[0,0,0,0,2],[0,1,0,0,0],[0,0,1,0,0],[-2,1,0,2,2],[0,0,0,2,1],[0,0,1,2,2],[-2,-1,0,2,2],[-2,0,1,0,0],[-2,0,0,2,1],[0,0,-1,2,2],[2,0,0,0,0],[0,0,1,0,1],[2,0,-1,2,2],[0,0,-1,0,1],[0,0,1,2,1],[-2,0,2,0,0],[0,0,-2,2,1],[2,0,0,2,2],[0,0,2,2,2],[0,0,2,0,0],[-2,0,1,2,2],[0,0,0,2,0],[-2,0,0,2,0],[0,0,-1,2,1],[0,2,0,0,0],[2,0,-1,0,1],[-2,2,0,2,2],[0,1,0,0,1],[-2,0,1,0,1],[0,-1,0,0,1],[0,0,2,-2,0],[2,0,-1,2,1],[2,0,1,2,2],[0,1,0,2,2],[-2,1,1,0,0],[0,-1,0,2,2],[2,0,0,2,1],[2,0,1,0,0],[-2,0,2,2,2],[-2,0,1,2,1],[2,0,-2,0,1],[2,0,0,0,1],[0,-1,1,0,0],[-2,-1,0,2,1],[-2,0,0,0,1],[0,0,2,2,1],[-2,0,2,0,1],[-2,1,0,2,1],[0,0,1,-2,0],[-1,0,1,0,0],[-2,1,0,0,0],[1,0,0,0,0],[0,0,1,2,0],[0,0,-2,2,2],[-1,-1,1,0,0],[0,1,1,0,0],[0,-1,1,2,2],[2,-1,-1,2,2],[0,0,3,2,2],[2,-1,0,2,2]],D=[[-171996,-174.2,92025,8.9],[-13187,-1.6,5736,-3.1],[-2274,-.2,977,-.5],[2062,.2,-895,.5],[1426,-3.4,54,-.1],[712,.1,-7,0],[-517,1.2,224,-.6],[-386,-.4,200,0],[-301,0,129,-.1],[217,-.5,-95,.3],[-158,0,0,0],[129,.1,-70,0],[123,0,-53,0],[63,0,0,0],[63,.1,-33,0],[-59,0,26,0],[-58,-.1,32,0],[-51,0,27,0],[48,0,0,0],[46,0,-24,0],[-38,0,16,0],[-31,0,13,0],[29,0,0,0],[29,0,-12,0],[26,0,0,0],[-22,0,0,0],[21,0,-10,0],[17,-.1,0,0],[16,0,-8,0],[-16,.1,7,0],[-15,0,9,0],[-13,0,7,0],[-12,0,6,0],[11,0,0,0],[-10,0,5,0],[-8,0,3,0],[7,0,-3,0],[-7,0,0,0],[-7,0,3,0],[-7,0,3,0],[6,0,0,0],[6,0,-3,0],[6,0,-3,0],[-6,0,3,0],[-6,0,3,0],[5,0,0,0],[-5,0,3,0],[-5,0,3,0],[-5,0,3,0],[4,0,0,0],[4,0,0,0],[4,0,0,0],[-4,0,0,0],[-4,0,0,0],[-4,0,0,0],[3,0,0,0],[-3,0,0,0],[-3,0,0,0],[-3,0,0,0],[-3,0,0,0],[-3,0,0,0],[-3,0,0,0],[-3,0,0,0]];function l(t){return Z/180*t}function M(t){return 180/Z*t}function I(t){let e=t/360;return e=360*(e-Math.floor(e)),e<0&&(e+=360),e}function Wt(t){let e=t/180;return e=180*(e-Math.floor(e)),e<0&&(e+=180),e}function Yt(t){let e=t/360;return e=360*(e-Math.floor(e)),e<-180?e+=360:e>180&&(e-=360),e}function P(t){let e=t-Math.floor(t);return e<0&&(e+=1),e}function _(t,e,n,o,i){return((t*i+e)*i+n)*i+o}function Vt(t){let e=t;return e<-20?e+=1440:e>20&&(e-=1440),e}function v(t,e){return 24*P(t+e/24)}function W(t,e,n){if(e<0||!isFinite(e))return new Date(NaN);const o=Math.floor(e),i=(e-o)*60,r=Math.floor(i),s=(i-r)*60,a=Math.floor(s),c=Math.round((s-a)*1e3),u=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0)),d=o-n;return u.setUTCHours(d,r,a,c),u}let A=function(t){return t[t.SPA_ZA=0]="SPA_ZA",t[t.SPA_ZA_INC=1]="SPA_ZA_INC",t[t.SPA_ZA_RTS=2]="SPA_ZA_RTS",t[t.SPA_ALL=3]="SPA_ALL",t}({}),S=function(t){return t[t.JD_MINUS=0]="JD_MINUS",t[t.JD_ZERO=1]="JD_ZERO",t[t.JD_PLUS=2]="JD_PLUS",t[t.JD_COUNT=3]="JD_COUNT",t}({}),f=function(t){return t[t.SUN_TRANSIT=0]="SUN_TRANSIT",t[t.SUN_RISE=1]="SUN_RISE",t[t.SUN_SET=2]="SUN_SET",t[t.SUN_COUNT=3]="SUN_COUNT",t}({});function Y(t,e,n,o,i,r,s,a){let c=t,u=e;const d=n+(o-a+(i+(r+s)/60)/60)/24;u<3&&(u+=12,c--);let h=Math.floor(365.25*(c+4716))+Math.floor(30.6001*(u+1))+d-1524.5;if(h>2299160){const g=Math.floor(c/100);h+=2-g+Math.floor(g/4)}return h}function V(t){return(t-2451545)/36525}function G(t,e){return t+e/86400}function K(t){return(t-2451545)/36525}function X(t){return t/10}function x(t,e,n){let o=0;for(let i=0;i<e;i++)o+=t[i][xt]*Math.cos(t[i][pt]+t[i][Ot]*n);return o}function p(t,e,n){let o=0;for(let i=0;i<e;i++)o+=t[i]*Math.pow(n,i);return o/=1e8,o}function Q(t){const e=[];for(let n=0;n<B;n++)e[n]=x(Ft[n],Nt[n],t);return I(M(p(e,B,t)))}function $(t){const e=[];for(let n=0;n<z;n++)e[n]=x(Zt[n],vt[n],t);return M(p(e,z,t))}function tt(t){const e=[];for(let n=0;n<H;n++)e[n]=x(Jt[n],bt[n],t);return p(e,H,t)}function et(t){let e=t+180;return e>=360&&(e-=360),e}function nt(t){return-t}function ot(t){return-20.4898/(3600*t)}function it(t,e,n){return t+e+n}function rt(t,e,n){const o=l(t),i=l(e);return I(M(Math.atan2(Math.sin(o)*Math.cos(i)-Math.tan(l(n))*Math.sin(i),Math.cos(o))))}function st(t,e,n){const o=l(t),i=l(e);return M(Math.asin(Math.sin(o)*Math.cos(i)+Math.cos(o)*Math.sin(i)*Math.sin(l(n))))}function Gt(t){return I(280.4664567+t*(360007.6982779+t*(.03032028+t*(1/49931+t*(-1/15300+t*(-1/2e6))))))}function Kt(t){return 8.794/(3600*t)}function at(t){return _(1/189474,-.0019142,445267.11148,297.85036,t)}function ct(t){return _(-1/3e5,-1603e-7,35999.05034,357.52772,t)}function lt(t){return _(1/56250,.0086972,477198.867398,134.96298,t)}function ut(t){return _(1/327270,-.0036825,483202.017538,93.27191,t)}function dt(t){return _(1/45e4,.0020708,-1934.136261,125.04452,t)}function Xt(t,e){let n=0;for(let o=0;o<Bt;o++)n+=e[o]*qt[t][o];return n}function ht(t,e){let n=0,o=0;for(let i=0;i<Ct;i++){const r=l(Xt(i,e));n+=(D[i][zt]+t*D[i][Ht])*Math.sin(r),o+=(D[i][kt]+t*D[i][jt])*Math.cos(r)}return{delPsi:n/36e6,delEpsilon:o/36e6}}function mt(t){const e=t/10;return 84381.448+e*(-4680.93+e*(-1.55+e*(1999.25+e*(-51.38+e*(-249.67+e*(-39.05+e*(7.12+e*(27.87+e*(5.79+e*2.45)))))))))}function ft(t,e){return t+e/3600}function gt(t,e){return I(280.46061837+360.98564736629*(t-2451545)+e*e*(387933e-9-e/3871e4))}function Mt(t,e,n){return t+e*Math.cos(l(n))}function Qt(t,e,n){return I(t+e-n)}function $t(t,e,n,o,i){const r=l(t),s=l(n),a=l(o),c=l(i),u=Math.atan(.99664719*Math.tan(r)),d=.99664719*Math.sin(u)+e*Math.sin(r)/6378140,h=Math.cos(u)+e*Math.cos(r)/6378140,g=Math.atan2(-h*Math.sin(s)*Math.sin(a),Math.cos(c)-h*Math.sin(s)*Math.cos(a)),y=M(Math.atan2((Math.sin(c)-d*Math.sin(s))*Math.cos(g),Math.cos(c)-h*Math.sin(s)*Math.cos(a)));return{deltaAlpha:M(g),deltaPrime:y}}function te(t,e){return t+e}function ee(t,e){return t-e}function ne(t,e,n){const o=l(t),i=l(e);return M(Math.asin(Math.sin(o)*Math.sin(i)+Math.cos(o)*Math.cos(i)*Math.cos(l(n))))}function oe(t,e,n,o){let i=0;return o>=-1*(J+n)&&(i=t/1010*(283/(273+e))*(1.02/(60*Math.tan(l(o+10.3/(o+5.11)))))),i}function ie(t,e){return t+e}function re(t){return 90-t}function se(t,e,n){const o=l(t),i=l(e);return I(M(Math.atan2(Math.sin(o),Math.cos(o)*Math.sin(i)-Math.tan(l(n))*Math.cos(i))))}function ae(t){return I(t+180)}function ce(t,e,n,o){const i=l(t),r=l(o);return M(Math.acos(Math.cos(i)*Math.cos(r)+Math.sin(r)*Math.sin(i)*Math.cos(l(e-n))))}function le(t,e,n){const o=l(t),i=l(e),r=(Math.sin(l(n))-Math.sin(o)*Math.sin(i))/(Math.cos(o)*Math.cos(i));return Math.abs(r)<=1?Wt(M(Math.acos(r))):L}function ue(t,e,n){return(t-e-n)/360}function de(t,e){const n=e/360;t[f.SUN_RISE]=P(t[f.SUN_TRANSIT]-n),t[f.SUN_SET]=P(t[f.SUN_TRANSIT]+n),t[f.SUN_TRANSIT]=P(t[f.SUN_TRANSIT])}function k(t,e){let n=t[S.JD_ZERO]-t[S.JD_MINUS],o=t[S.JD_PLUS]-t[S.JD_ZERO];return Math.abs(n)>=2&&(n=P(n)),Math.abs(o)>=2&&(o=P(o)),t[S.JD_ZERO]+e*(n+o+(o-n)*e)/2}function he(t,e,n){const o=l(t),i=l(e);return M(Math.asin(Math.sin(o)*Math.sin(i)+Math.cos(o)*Math.cos(i)*Math.cos(l(n))))}function j(t,e,n,o,i,r,s){return t[s]+(e[s]-r)/(360*Math.cos(l(n[s]))*Math.cos(l(o))*Math.sin(l(i[s])))}function me(t,e,n,o){return Vt(4*(t-.0057183-e+n*Math.cos(l(o))))}function fe(t,e){const n=-1*(J+t.atmosphericRefraction),o=Y(t.year,t.month,t.day,0,0,0,0,0),i=e(o,t.deltaT).nu,r=me(Gt(t.jme),t.alpha,t.delPsi,t.epsilon),s=[],a=[];for(let m=0;m<S.JD_COUNT;m++){const U=e(o+m-1,t.deltaT);s[m]=U.alpha,a[m]=U.delta}const c=[];c[f.SUN_TRANSIT]=ue(s[S.JD_ZERO],t.longitude,i);const u=le(t.latitude,a[S.JD_ZERO],n);if(u===L)return{sunrise:L,suntransit:L,sunset:L,srha:L,ssha:L,sta:L,eot:r};de(c,u);const d=[],h=[],g=[],y=[],T=[];for(let m=0;m<f.SUN_COUNT;m++){d[m]=i+360.985647*c[m];const U=c[m]+t.deltaT/86400;g[m]=k(s,U),y[m]=k(a,U),h[m]=Yt(d[m]+t.longitude-g[m]),T[m]=he(t.latitude,y[m],h[m])}const N=h[f.SUN_RISE],Pt=h[f.SUN_SET],Ut=T[f.SUN_TRANSIT],_t=v(c[f.SUN_TRANSIT]-h[f.SUN_TRANSIT]/360,t.timezone);return{sunrise:v(j(c,T,y,t.latitude,h,n,f.SUN_RISE),t.timezone),suntransit:_t,sunset:v(j(c,T,y,t.latitude,h,n,f.SUN_SET),t.timezone),srha:N,ssha:Pt,sta:Ut,eot:r}}function ge(){return{year:0,month:0,day:0,hour:0,minute:0,second:0,deltaUt1:0,deltaT:67,timezone:0,longitude:0,latitude:0,elevation:0,pressure:1013,temperature:15,slope:0,azimuthRotation:0,atmosphericRefraction:q,function:A.SPA_ALL,jd:0,jc:0,jde:0,jce:0,jme:0,l:0,b:0,r:0,theta:0,beta:0,x0:0,x1:0,x2:0,x3:0,x4:0,delPsi:0,delEpsilon:0,epsilon0:0,epsilon:0,delTau:0,lamda:0,nu0:0,nu:0,alpha:0,delta:0,h:0,xi:0,delAlpha:0,deltaPrime:0,alphaPrime:0,hPrime:0,e0:0,delE:0,e:0,eot:0,srha:0,ssha:0,sta:0,zenith:0,azimuthAstro:0,azimuth:0,incidence:0,suntransit:0,sunrise:0,sunset:0}}function Me(t){return t.year<-2e3||t.year>6e3?1:t.month<1||t.month>12?2:t.day<1||t.day>31?3:t.hour<0||t.hour>24?4:t.minute<0||t.minute>59?5:t.second<0||t.second>=60?6:t.pressure<0||t.pressure>5e3?12:t.temperature<=-273||t.temperature>6e3?13:t.deltaUt1<=-1||t.deltaUt1>=1?17:t.hour===24&&t.minute>0?5:t.hour===24&&t.second>0?6:Math.abs(t.deltaT)>8e3?7:Math.abs(t.timezone)>18?8:Math.abs(t.longitude)>180?9:Math.abs(t.latitude)>90?10:Math.abs(t.atmosphericRefraction)>5?16:t.elevation<-65e5?11:0}function ye(t){t.jc=V(t.jd),t.jde=G(t.jd,t.deltaT),t.jce=K(t.jde),t.jme=X(t.jce),t.l=Q(t.jme),t.b=$(t.jme),t.r=tt(t.jme),t.theta=et(t.l),t.beta=nt(t.b),t.x0=at(t.jce),t.x1=ct(t.jce),t.x2=lt(t.jce),t.x3=ut(t.jce),t.x4=dt(t.jce);const e=[t.x0,t.x1,t.x2,t.x3,t.x4],n=ht(t.jce,e);t.delPsi=n.delPsi,t.delEpsilon=n.delEpsilon,t.epsilon0=mt(t.jme),t.epsilon=ft(t.delEpsilon,t.epsilon0),t.delTau=ot(t.r),t.lamda=it(t.theta,t.delPsi,t.delTau),t.nu0=gt(t.jd,t.jc),t.nu=Mt(t.nu0,t.delPsi,t.epsilon),t.alpha=rt(t.lamda,t.epsilon,t.beta),t.delta=st(t.beta,t.epsilon,t.lamda)}function Le(t,e){const n=V(t),o=K(G(t,e)),i=X(o),r=Q(i),s=$(i),a=tt(i),c=et(r),u=nt(s),d=ht(o,[at(o),ct(o),lt(o),ut(o),dt(o)]),h=mt(i),g=ft(d.delEpsilon,h),y=ot(a),T=it(c,d.delPsi,y),N=Mt(gt(t,n),d.delPsi,g);return{alpha:rt(T,g,u),delta:st(u,g,T),nu:N}}function yt(t){const e=Me(t);if(e!==0)return e;t.jd=Y(t.year,t.month,t.day,t.hour,t.minute,t.second,t.deltaUt1,t.timezone),ye(t),t.h=Qt(t.nu,t.longitude,t.alpha),t.xi=Kt(t.r);const n=$t(t.latitude,t.elevation,t.xi,t.h,t.delta);if(t.delAlpha=n.deltaAlpha,t.deltaPrime=n.deltaPrime,t.alphaPrime=te(t.alpha,t.delAlpha),t.hPrime=ee(t.h,t.delAlpha),t.e0=ne(t.latitude,t.deltaPrime,t.hPrime),t.delE=oe(t.pressure,t.temperature,t.atmosphericRefraction,t.e0),t.e=ie(t.e0,t.delE),t.zenith=re(t.e),t.azimuthAstro=se(t.hPrime,t.latitude,t.deltaPrime),t.azimuth=ae(t.azimuthAstro),(t.function===A.SPA_ZA_INC||t.function===A.SPA_ALL)&&(t.incidence=ce(t.zenith,t.azimuthAstro,t.azimuthRotation,t.slope)),t.function===A.SPA_ZA_RTS||t.function===A.SPA_ALL){const o=fe(t,Le);t.sunrise=o.sunrise,t.suntransit=o.suntransit,t.sunset=o.sunset,t.srha=o.srha,t.ssha=o.ssha,t.sta=o.sta,t.eot=o.eot}return 0}function Lt(t,e,n,o={}){const i=ge();return i.year=t.getFullYear(),i.month=t.getMonth()+1,i.day=t.getDate(),i.hour=t.getHours(),i.minute=t.getMinutes(),i.second=t.getSeconds()+t.getMilliseconds()/1e3,i.timezone=-t.getTimezoneOffset()/60,i.latitude=e,i.longitude=n,i.elevation=o.elevation??0,i.pressure=o.pressure??1013,i.temperature=o.temperature??15,i.deltaUt1=o.deltaUt1??0,i.deltaT=o.deltaT??67,i.slope=o.slope??0,i.azimuthRotation=o.azimuthRotation??0,i.atmosphericRefraction=o.atmosphericRefraction??q,i.function=A.SPA_ALL,i}function St(t){return t!==L&&isFinite(t)&&t>=0}function Tt(t,e,n=new Date,o){const i=Lt(n,t,e,o);return yt(i)!==0||!St(i.sunrise)?null:W(n,i.sunrise,i.timezone)}function Et(t,e,n=new Date,o){const i=Lt(n,t,e,o);return yt(i)!==0||!St(i.sunset)?null:W(n,i.sunset,i.timezone)}function w(t,e=new Date){try{if(Math.abs(t.latitude)>66.5)return Se(t,e);const n=Et(t.latitude,t.longitude,e),o=Tt(t.latitude,t.longitude,e);if(!n||!o)return{success:!1,error:"Unable to calculate sunset times for this location and date",isPolarRegion:!1};const i=Rt(t);return{success:!0,sunsetInfo:{sunset:n,sunrise:o,location:t,date:e,timezone:i,hasSunset:!0}}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error calculating sunset"}}}function Se(t,e){const n=Te(e),o=t.latitude>0,i=n>=150&&n<=200,r=n>=340||n<=50;let s;o?s=i?"midnight-sun":r?"polar-night":"midnight-sun":s=i?"polar-night":r?"midnight-sun":"polar-night";const a=Et(t.latitude,t.longitude,e),c=Tt(t.latitude,t.longitude,e);return a&&c?{success:!0,sunsetInfo:{sunset:a,sunrise:c,location:t,date:e,timezone:Rt(t),hasSunset:!0},isPolarRegion:!0}:{success:!1,error:`${s==="midnight-sun"?"Midnight sun":"Polar night"} - no sunset during this period`,isPolarRegion:!0,polarType:s}}function Rt(t){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{const e=Math.round(t.longitude/15),n=e>=0?"+":"-",o=Math.abs(e);return`UTC${n}${o.toString().padStart(2,"0")}:00`}}function Te(t){const e=new Date(t.getFullYear(),0,0),n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60*24))}function O(t,e,n=new Date,o=365){const i=e.getHours(),r=e.getMinutes(),s=i*60+r;for(let a=0;a<o;a++){const c=new Date(n);c.setDate(c.getDate()+a);const u=w(t,c);if(u.success&&u.sunsetInfo){const d=u.sunsetInfo.sunset,h=d.getHours(),g=d.getMinutes();if(h*60+g>=s)return{date:c,sunsetTime:d}}}return null}function C(t){const e=t.getMinutes();return e===0?"hour":e===30?"half-hour":"exact-sunset"}function It(t,e){return e==="exact-sunset"?"Sunset":e==="golden-hour"?"Golden Hour":t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function At(t,e=new Date){try{const n=w(t,e);if(!n.success)return{milestone:null,sunsetInfo:null,daysUntil:0,error:n.error};const o=n.sunsetInfo.sunset,i=o.getHours(),r=o.getMinutes();let s;r<30?(s=new Date(o),s.setMinutes(30,0,0)):(s=new Date(o),s.setHours(i+1,0,0,0));const a=O(t,s,e,365);if(!a)return{milestone:null,sunsetInfo:null,daysUntil:0,error:"Could not find when sunset reaches next milestone"};const c=Math.ceil((a.date.getTime()-e.getTime())/(1e3*60*60*24)),u={time:s,type:C(s),label:It(s,C(s)),isPrimary:!0},d=w(t,a.date);return{milestone:u,sunsetInfo:d.success?d.sunsetInfo:n.sunsetInfo,daysUntil:c}}catch(n){return{milestone:null,sunsetInfo:null,daysUntil:0,error:n instanceof Error?n.message:"Unknown error calculating milestone"}}}function Ee(t,e=new Date,n=4){try{const o=At(t,e);if(!o.milestone)return[];const i=[];let r=new Date(o.milestone.time);for(let s=0;s<n&&(r=new Date(r.getTime()+30*60*1e3),!(r.getHours()>21||r.getHours()===21&&r.getMinutes()>30));s++){const a=O(t,r,e,365);if(a){const c=Math.ceil((a.sunsetTime.getTime()-e.getTime())/864e5),u={time:r,type:C(r),label:It(r,C(r)),isPrimary:!1,targetDate:a.sunsetTime,daysUntil:c};i.push(u)}}return i}catch{return[]}}function F(t,e=new Date){const n=At(t,e);if(!n.milestone||n.daysUntil<0)return null;const o=O(t,n.milestone.time,e,365);if(!o)return null;const i=e,r=o.sunsetTime,s=r.getTime()-i.getTime(),a=Math.floor(s/(1e3*60));if(s<0)return null;const c=Math.floor(s/(1e3*60*60*24)),u=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),d=Math.floor(s%(1e3*60*60)/(1e3*60)),h=Math.floor(s%(1e3*60)/1e3);return{timeRemaining:{days:c,hours:u,minutes:d,seconds:h},milestone:n.milestone,totalMinutes:a,targetDate:r}}class Re{constructor(){E(this,"geolocationService");E(this,"currentLocation",null);E(this,"updateInterval",null);this.geolocationService=b.getInstance(),this.init()}async init(){console.log("ðŸŒ… Initializing Sunset Countdown App..."),this.setupEventListeners(),await this.loadInitialLocation(),this.startUpdateLoop(),console.log("âœ… App initialized successfully")}setupEventListeners(){const e=document.getElementById("change-location-btn");e&&e.addEventListener("click",()=>this.showLocationPicker());const n=document.getElementById("location-form");n&&n.addEventListener("submit",s=>this.handleLocationSubmit(s));const o=document.getElementById("auto-detect-btn");o&&o.addEventListener("click",()=>this.autoDetectLocation());const i=document.getElementById("location-search");i&&i.addEventListener("input",s=>this.handleLocationSearch(s));const r=document.getElementById("close-picker-btn");r&&r.addEventListener("click",()=>this.hideLocationPicker())}async loadInitialLocation(){this.currentLocation=this.geolocationService.getDefaultLocation(),console.log("ðŸ“ Using default location:",this.currentLocation.name),await this.updateDisplay(),this.hideLoading();try{const e=await this.geolocationService.getCurrentLocation();e.location&&e.location.source==="geolocation"&&(this.currentLocation=e.location,console.log("ðŸ“ Updated to actual location:",this.currentLocation.name),await this.updateDisplay())}catch{console.log("Could not get actual location, using default")}}updateCountdownOnly(){if(this.currentLocation)try{const e=F(this.currentLocation,new Date);e&&this.updateCountdownDisplay(e)}catch(e){console.error("Error updating countdown:",e)}}async updateDisplay(){if(this.currentLocation)try{this.updateLocationDisplay(this.currentLocation);const e=F(this.currentLocation);if(e){this.updateCountdownDisplay(e);const o=Ee(this.currentLocation);this.updateMilestonesList(o)}else this.showError("Unable to calculate sunset milestones for this location");const n=w(this.currentLocation);n.success&&n.sunsetInfo&&this.updateCurrentSunsetInfo(n.sunsetInfo)}catch(e){console.error("Error updating display:",e),this.showError("Failed to update sunset information")}}updateLocationDisplay(e){const n=document.getElementById("current-location");n&&(n.textContent=e.name||`${e.latitude.toFixed(4)}, ${e.longitude.toFixed(4)}`);const o=document.getElementById("location-source");if(o){const i=e.source==="geolocation"?"Automatically detected":e.source==="search"?"From search":"Manual entry";o.textContent=i}}updateCountdownDisplay(e){const n=document.getElementById("next-milestone");n&&(n.textContent=e.milestone.label);const o=document.getElementById("days-count"),i=document.getElementById("hours-count"),r=document.getElementById("minutes-count"),s=document.getElementById("seconds-count");o&&(o.textContent=e.timeRemaining.days.toString()),i&&(i.textContent=e.timeRemaining.hours.toString().padStart(2,"0")),r&&(r.textContent=e.timeRemaining.minutes.toString().padStart(2,"0")),s&&(s.textContent=e.timeRemaining.seconds.toString().padStart(2,"0"));const a=document.getElementById("countdown-message");if(a){const c=e.targetDate.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});e.timeRemaining.days===0?a.textContent=`Sunset reaches ${e.milestone.label} today!`:e.timeRemaining.days===1?a.textContent=`Only 1 more day until sunset is ${e.milestone.label} on ${c}`:a.textContent=`Only ${e.timeRemaining.days} more days until sunset is ${e.milestone.label} on ${c}`}}updateMilestonesList(e){const n=document.getElementById("milestones-list");n&&(n.innerHTML="",e.forEach(o=>{const i=o.targetDate.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),r=o.daysUntil===0?"Today":o.daysUntil===1?"Tomorrow":`${o.daysUntil} days`,s=document.createElement("div");s.className="milestone-item",s.innerHTML=`
        <span class="milestone-time">${o.label}</span>
        <span class="milestone-note">${r} â€¢ ${i}</span>
      `,n.appendChild(s)}))}updateCurrentSunsetInfo(e){const n=document.getElementById("today-sunset");if(n){const o=e.sunset.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});n.textContent=`Today's sunset: ${o}`}}showLocationPicker(){const e=document.getElementById("location-modal");if(e){e.style.display="block",this.updateRecentLocationsList();const n=document.getElementById("location-search");n&&(n.value="",n.focus())}}hideLocationPicker(){const e=document.getElementById("location-modal");e&&(e.style.display="none")}async handleLocationSubmit(e){e.preventDefault();const n=e.target,o=new FormData(n),i=parseFloat(o.get("latitude")),r=parseFloat(o.get("longitude")),s=o.get("location-name");this.geolocationService.isValidLocation(i,r)?(this.currentLocation=this.geolocationService.setManualLocation(i,r,s),this.hideLocationPicker(),await this.updateDisplay()):this.showError("Please enter valid coordinates (latitude: -90 to 90, longitude: -180 to 180)")}async handleLocationSearch(e){const o=e.target.value.trim();if(o.length<2){this.clearSearchResults();return}const i=await this.geolocationService.searchLocation(o);this.displaySearchResults(i)}displaySearchResults(e){const n=document.getElementById("search-results");if(n){if(n.innerHTML="",e.length===0){n.innerHTML='<div class="search-result no-results">No locations found</div>';return}e.forEach(o=>{const i=document.createElement("div");i.className="search-result",i.innerHTML=`
        <span class="location-name">${o.name}</span>
        <span class="location-coords">${o.latitude.toFixed(4)}, ${o.longitude.toFixed(4)}</span>
      `,i.addEventListener("click",async()=>{this.currentLocation=this.geolocationService.setManualLocation(o.latitude,o.longitude,o.name),this.hideLocationPicker(),await this.updateDisplay()}),n.appendChild(i)})}}clearSearchResults(){const e=document.getElementById("search-results");e&&(e.innerHTML="")}updateRecentLocationsList(){const e=document.getElementById("recent-locations");if(!e)return;const n=this.geolocationService.getRecentLocations();if(e.innerHTML="",n.length===0){e.innerHTML='<div class="recent-location no-recent">No recent locations</div>';return}n.forEach(o=>{const i=document.createElement("div");i.className="recent-location",i.innerHTML=`
        <span class="location-name">${o.name}</span>
        <span class="location-coords">${o.latitude.toFixed(4)}, ${o.longitude.toFixed(4)}</span>
      `,i.addEventListener("click",async()=>{this.currentLocation=this.geolocationService.setManualLocation(o.latitude,o.longitude,o.name),this.hideLocationPicker(),await this.updateDisplay()}),e.appendChild(i)})}async autoDetectLocation(){var e;this.showLoading("Detecting your location...");try{const n=await this.geolocationService.detectLocation();n.location?(this.currentLocation=n.location,this.hideLocationPicker(),await this.updateDisplay()):this.showLocationError(((e=n.error)==null?void 0:e.message)||"Unable to detect location")}catch(n){console.error("Auto-detection failed:",n),this.showLocationError("Location detection failed")}finally{this.hideLoading()}}startUpdateLoop(){this.updateInterval=window.setInterval(()=>{this.currentLocation&&this.updateCountdownOnly()},1e3),window.setInterval(()=>{this.currentLocation&&this.updateDisplay()},3e5)}stopUpdateLoop(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}showLoading(e){const n=document.getElementById("loading-message");n&&(n.textContent=e,n.style.display="block")}hideLoading(){const e=document.getElementById("loading-message");e&&(e.style.display="none")}showError(e){const n=document.getElementById("error-message");n&&(n.textContent=e,n.style.display="block",setTimeout(()=>{n.style.display="none"},5e3))}showLocationError(e){const n=document.getElementById("location-error");n&&(n.textContent=e,n.style.display="block")}destroy(){this.stopUpdateLoop(),this.geolocationService.stopWatchingLocation()}}document.addEventListener("DOMContentLoaded",()=>{new Re});
